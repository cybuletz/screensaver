<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screensaver Settings</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .settings-group {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }

        .settings-group h2 {
            margin-top: 0;
            color: #34495e;
            font-size: 1.2em;
        }

        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="number"],
        input[type="time"],
        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        input[type="color"] {
            width: 50px;
            height: 30px;
            padding: 0;
            border: none;
        }

        input[type="checkbox"] {
            margin-right: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .checkbox-label span {
            margin-left: 5px;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
button.primary {
            background-color: #3498db;
            color: white;
        }

        button.primary:hover {
            background-color: #2980b9;
        }

        button.secondary {
            background-color: #95a5a6;
            color: white;
        }

        button.secondary:hover {
            background-color: #7f8c8d;
        }

        button.danger {
            background-color: #e74c3c;
            color: white;
        }

        button.danger:hover {
            background-color: #c0392b;
        }

        .album-list {
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }

        .album-item {
            display: flex;
            align-items: center;
            padding: 5px;
            margin: 5px 0;
            background: #fff;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .album-item:hover {
            background: #f0f0f0;
        }

        .album-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
            border-radius: 4px;
        }

        .album-item .album-info {
            flex-grow: 1;
        }

        .album-item .album-title {
            font-weight: bold;
        }

        .album-item .album-count {
            font-size: 0.9em;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }

        .error {
            color: #e74c3c;
            padding: 10px;
            margin: 10px 0;
            background: #fde9e8;
            border-radius: 4px;
            text-align: center;
        }

        .success {
            color: #27ae60;
            padding: 10px;
            margin: 10px 0;
            background: #e8f6e9;
            border-radius: 4px;
            text-align: center;
        }

        .days-selector {
            display: flex;
            gap: 5px;
            margin: 10px 0;
        }
.day-button {
            flex: 1;
            padding: 5px;
            border: 1px solid #ddd;
            background: #fff;
            cursor: pointer;
            border-radius: 4px;
            text-align: center;
        }

        .day-button.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .settings-group {
                padding: 10px;
            }

            button {
                width: 100%;
                margin: 5px 0;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Screensaver Settings</h1>
        
        <div class="settings-group">
            <h2>Display Settings</h2>
            <label for="resolution">Resolution:</label>
            <select id="resolution">
                <option value="auto">Auto (Screen Resolution)</option>
                <option value="1920x1080">1920x1080 (FHD)</option>
                <option value="2560x1440">2560x1440 (QHD)</option>
                <option value="3840x2160">3840x2160 (4K)</option>
            </select>

            <label for="fitMode">Image Fit Mode:</label>
            <select id="fitMode">
                <option value="cover">Cover (Fill Screen)</option>
                <option value="contain">Contain (Show Full Image)</option>
            </select>

            <label for="interval">Photo Interval (seconds):</label>
            <input type="number" id="interval" min="5" max="3600" value="30">

            <label for="transition">Transition Effect:</label>
            <select id="transition">
                <option value="fade">Fade</option>
                <option value="slide">Slide</option>
                <option value="zoom">Zoom</option>
                <option value="blur">Blur</option>
            </select>

            <label for="transitionDuration">Transition Duration (seconds):</label>
            <input type="number" id="transitionDuration" min="0.5" max="5" step="0.5" value="1">

            <div class="checkbox-label">
                <input type="checkbox" id="shuffle">
                <span>Shuffle Photos</span>
            </div>
        </div>
<div class="settings-group">
            <h2>Clock Settings</h2>
            <div class="checkbox-label">
                <input type="checkbox" id="showClock">
                <span>Show Clock</span>
            </div>

            <label for="clockStyle">Clock Style:</label>
            <select id="clockStyle">
                <option value="digital">Digital</option>
                <option value="analog">Analog</option>
            </select>

            <label for="clockFormat">Time Format:</label>
            <select id="clockFormat">
                <option value="24">24-hour</option>
                <option value="12">12-hour</option>
            </select>

            <label for="clockPosition">Clock Position:</label>
            <select id="clockPosition">
                <option value="top-left">Top Left</option>
                <option value="top-right">Top Right</option>
                <option value="bottom-left">Bottom Left</option>
                <option value="bottom-right">Bottom Right</option>
                <option value="center">Center</option>
            </select>

            <label for="clockColor">Clock Color:</label>
            <input type="color" id="clockColor" value="#ffffff">

            <label for="clockSize">Clock Size:</label>
            <select id="clockSize">
                <option value="small">Small</option>
                <option value="medium">Medium</option>
                <option value="large">Large</option>
            </select>
        </div>

        <div class="settings-group">
            <h2>Weather Settings</h2>
            <div class="checkbox-label">
                <input type="checkbox" id="showWeather">
                <span>Show Weather</span>
            </div>

            <label for="weatherCity">City:</label>
            <input type="text" id="weatherCity" placeholder="Enter city name">

            <label for="weatherPosition">Weather Position:</label>
            <select id="weatherPosition">
                <option value="top-left">Top Left</option>
                <option value="top-right">Top Right</option>
                <option value="bottom-left">Bottom Left</option>
                <option value="bottom-right">Bottom Right</option>
            </select>

            <div class="checkbox-label">
                <input type="checkbox" id="showForecast">
                <span>Show Weather Forecast</span>
            </div>
        </div>

        <div class="settings-group">
            <h2>Schedule Settings</h2>
            <div class="checkbox-label">
                <input type="checkbox" id="enableSchedule">
                <span>Enable Schedule</span>
            </div>

            <label for="startTime">Start Time:</label>
            <input type="time" id="startTime">

            <label for="endTime">End Time:</label>
            <input type="time" id="endTime">

            <label>Active Days:</label>
            <div class="days-selector">
                <div class="day-button" data-day="0">Sun</div>
                <div class="day-button" data-day="1">Mon</div>
                <div class="day-button" data-day="2">Tue</div>
                <div class="day-button" data-day="3">Wed</div>
                <div class="day-button" data-day="4">Thu</div>
                <div class="day-button" data-day="5">Fri</div>
                <div class="day-button" data-day="6">Sat</div>
            </div>
        </div>

        <div class="settings-group">
            <h2>Google Photos Albums</h2>
            <div id="albumList" class="album-list">
                <div class="loading">Loading albums...</div>
            </div>
        </div>

        <div class="button-group">
            <button onclick="saveSettings()" class="primary">Save Settings</button>
            <button onclick="startScreensaver()" class="primary">Start Screensaver</button>
            <button onclick="logout()" class="secondary">Logout</button>
            <button onclick="clearCache()" class="danger">Clear Cache</button>
        </div>
    </div>

    <script>
        let selectedAlbums = [];
        
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('screensaverSettings')) || {
                resolution: 'auto',
                fitMode: 'cover',
                showClock: true,
                clockStyle: 'digital',
                clockFormat: '24',
                clockPosition: 'bottom-right',
                clockColor: '#ffffff',
                clockSize: 'medium',
                interval: 30,
                transition: 'fade',
                transitionDuration: 1,
                shuffle: true,
                enableSchedule: false,
                startTime: '09:00',
                endTime: '17:00',
                daysActive: [1,2,3,4,5],
                showWeather: true,
                weatherCity: 'Bucharest',
                weatherPosition: 'top-right',
                showForecast: false
            };

            // Apply settings to form
            Object.keys(settings).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = settings[key];
                    } else {
                        element.value = settings[key];
                    }
                }
            });

            // Set active days
            document.querySelectorAll('.day-button').forEach(button => {
                const day = parseInt(button.dataset.day);
                if (settings.daysActive.includes(day)) {
                    button.classList.add('active');
                }
            });

            // Load selected albums
            selectedAlbums = JSON.parse(localStorage.getItem('selectedAlbums')) || [];
        }

        async function fetchAlbums() {
            try {
                const response = await fetch('/albums');
                if (!response.ok) throw new Error('Failed to fetch albums');
                const albums = await response.json();
                displayAlbums(albums);
            } catch (error) {
                console.error('Error fetching albums:', error);
                document.getElementById('albumList').innerHTML = 
                    '<div class="error">Failed to load albums. Please try again.</div>';
            }
        }

        function displayAlbums(albums) {
            const albumList = document.getElementById('albumList');
            albumList.innerHTML = albums.map(album => `
                <div class="album-item" onclick="toggleAlbum('${album.id}', this)">
                    <img src="${album.coverPhotoBaseUrl}" alt="${album.title}">
                    <div class="album-info">
                        <div class="album-title">${album.title}</div>
                        <div class="album-count">${album.mediaItemsCount} items</div>
                    </div>
                    <input type="checkbox" 
                           ${selectedAlbums.includes(album.id) ? 'checked' : ''}>
                </div>
            `).join('');
        }

        function toggleAlbum(albumId, element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                if (!selectedAlbums.includes(albumId)) {
                    selectedAlbums.push(albumId);
                }
            } else {
                const index = selectedAlbums.indexOf(albumId);
                if (index > -1) {
                    selectedAlbums.splice(index, 1);
                }
            }
        }

        function saveSettings() {
            const settings = {
                resolution: document.getElementById('resolution').value,
                fitMode: document.getElementById('fitMode').value,
                showClock: document.getElementById('showClock').checked,
                clockStyle: document.getElementById('clockStyle').value,
                clockFormat: document.getElementById('clockFormat').value,
                clockPosition: document.getElementById('clockPosition').value,
                clockColor: document.getElementById('clockColor').value,
                clockSize: document.getElementById('clockSize').value,
                interval: parseInt(document.getElementById('interval').value),
                transition: document.getElementById('transition').value,
                transitionDuration: parseFloat(document.getElementById('transitionDuration').value),
                shuffle: document.getElementById('shuffle').checked,
                enableSchedule: document.getElementById('enableSchedule').checked,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value,
                daysActive: Array.from(document.querySelectorAll('.day-button.active'))
                    .map(button => parseInt(button.dataset.day)),
                showWeather: document.getElementById('showWeather').checked,
                weatherCity: document.getElementById('weatherCity').value,
                weatherPosition: document.getElementById('weatherPosition').value,
                showForecast: document.getElementById('showForecast').checked
            };

            localStorage.setItem('screensaverSettings', JSON.stringify(settings));
            localStorage.setItem('selectedAlbums', JSON.stringify(selectedAlbums));

            const successMessage = document.createElement('div');
            successMessage.className = 'success';
            successMessage.textContent = 'Settings saved successfully!';
            document.querySelector('.container').appendChild(successMessage);
            setTimeout(() => successMessage.remove(), 3000);
        }

        function startScreensaver() {
            window.location.href = '/';
        }

        async function logout() {
            try {
                await fetch('/logout');
                window.location.href = '/login';
            } catch (error) {
                console.error('Error during logout:', error);
            }
        }

        async function clearCache() {
            try {
                await fetch('/clear-cache');
                const successMessage = document.createElement('div');
                successMessage.className = 'success';
                successMessage.textContent = 'Cache cleared successfully!';
                document.querySelector('.container').appendChild(successMessage);
                setTimeout(() => successMessage.remove(), 3000);
            } catch (error) {
                console.error('Error clearing cache:', error);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            fetchAlbums();

            // Set up day button toggling
            document.querySelectorAll('.day-button').forEach(button => {
                button.addEventListener('click', () => {
                    button.classList.toggle('active');
                });
            });
        });
    </script>
</body>
</html>